<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roulette Russe de Sandwich</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        .spin-button {
            transition: all 0.3s ease;
        }

        .spin-button:hover {
            transform: scale(1.05);
        }

        .wheel-container {
            position: relative;
            overflow: hidden;
            border-radius: 50%;
        }

        .wheel {
            transition: transform 3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .bounce {
            animation: bounce 1s infinite;
        }
    </style>
</head>

<body class="bg-yellow-50 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-red-600 mb-2">Roulette Russe de Sandwich</h1>
            <p class="text-xl text-gray-700">Laissez le hasard d√©cider votre sandwich du midi!</p>
        </header>

        <div class="bg-white rounded-lg shadow-xl p-6 max-w-2xl mx-auto">
            <div id="history-banner" class="mb-4 p-3 bg-blue-100 rounded-lg hidden">
                <div class="flex justify-between items-center">
                    <p class="text-blue-800 font-medium">Vous avez <span id="history-count" class="font-bold">0</span>
                        sandwichs enregistr√©s!</p>
                    <button id="show-history-button"
                        class="text-blue-800 hover:text-blue-900 font-medium text-sm px-3 py-1 bg-blue-200 rounded-md">
                        Voir l'historique
                    </button>
                </div>
            </div>

            <div id="history-modal"
                class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-lg shadow-xl p-6 max-w-2xl mx-auto w-11/12 max-h-screen overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-2xl font-bold text-gray-800">Historique des sandwichs</h3>
                        <button id="close-history-button" class="text-gray-600 hover:text-gray-800">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="history-list" class="space-y-3">
                        <!-- L'historique sera ins√©r√© ici -->
                    </div>
                    <div class="mt-4 text-right">
                        <button id="clear-history-button"
                            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                            Effacer l'historique
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex flex-col md:flex-row gap-8">
                <div class="md:w-1/2">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-center mb-4 text-red-500">Votre Sandwich Al√©atoire</h2>

                        <div class="flex flex-col gap-4 p-4 bg-yellow-100 rounded-lg">
                            <div class="flex items-center">
                                <span class="w-24 font-medium text-gray-700">Pain:</span>
                                <span id="bread-result" class="font-bold text-red-600">---</span>
                            </div>
                            <div class="flex items-center">
                                <span class="w-24 font-medium text-gray-700">Viande:</span>
                                <span id="meat-result" class="font-bold text-red-600">---</span>
                            </div>
                            <div class="flex items-center">
                                <span class="w-24 font-medium text-gray-700">Fromage:</span>
                                <span id="cheese-result" class="font-bold text-red-600">---</span>
                            </div>
                            <div class="flex items-center">
                                <span class="w-24 font-medium text-gray-700">Extra:</span>
                                <span id="extra-result" class="font-bold text-red-600">---</span>
                            </div>
                        </div>
                    </div>

                    <div class="text-center flex flex-col gap-3">
                        <button id="spin-button"
                            class="spin-button bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-full shadow-lg text-xl">
                            üéØ Lancer la Roulette
                        </button>
                        <button id="save-button"
                            class="spin-button bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full shadow-lg text-lg opacity-50"
                            disabled>
                            üíæ Valider ce sandwich
                        </button>
                    </div>
                </div>

                <div class="md:w-1/2">
                    <div class="wheel-container bg-yellow-300 w-64 h-64 mx-auto">
                        <div id="wheel" class="wheel w-full h-full bg-yellow-300 flex items-center justify-center">
                            <div class="text-center">
                                <span id="spinning-text" class="text-2xl font-bold text-red-600">Pr√™t?</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 p-4 bg-gray-100 rounded-lg">
                <h3 class="text-xl font-semibold mb-3">Ingr√©dients Disponibles</h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-medium text-red-600 mb-1">Pains</h4>
                        <ul id="bread-list" class="list-disc list-inside text-gray-700"></ul>
                    </div>

                    <div>
                        <h4 class="font-medium text-red-600 mb-1">Viandes</h4>
                        <ul id="meat-list" class="list-disc list-inside text-gray-700"></ul>
                    </div>

                    <div>
                        <h4 class="font-medium text-red-600 mb-1">Fromages</h4>
                        <ul id="cheese-list" class="list-disc list-inside text-gray-700"></ul>
                    </div>

                    <div>
                        <h4 class="font-medium text-red-600 mb-1">Extras</h4>
                        <ul id="extra-list" class="list-disc list-inside text-gray-700"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Cl√© pour le localStorage
        const SANDWICH_HISTORY_KEY = 'sandwichRoulette_history';

        // Ingr√©dients disponibles
        const ingredients = {
            bread: [
                "Ficelle"
            ],
            meat: [
                "Mortadelle", "Jambon blanc", "Jambon de pays",
                "Rosette", "Chorizo", "Bacon", "Poulet r√¥ti",
                "R√¥ti de b≈ìuf", "Salami", "Dinde", "Pastrami"
            ],
            cheese: [
                "Maasdam", "Gouda", "Emmental", "Comt√©",
                "Cheddar", "Mozzarella", "Brie", "Ch√®vre",
                "Bleu", "Raclette", "Camembert"
            ],
            extra: [
                "Chips Brets saveur Miel Moutarde",
                "Chips Brets saveur Pili Pili",
                "Chips Brets saveur Beurre Sal√©",
                "Chips Brets saveur Pesto Mozzarella",
                "Chips Brets saveur Fromage du Jura",
                "Chips Brets saveur Sel & Vinaigre",
                "Chips Brets saveur Ch√®vre & Piment d'Espelette",
                "Chips Brets saveur Poulet Brais√©",
                "Chips Brets saveur C√®pes",
                "Chips Brets saveur Bacon Grill√©",
                "Chips Brets saveur Camembert",
                "Chips Brets saveur Sauce Pommes Frites",
                "Chips Brets saveur A√Øoli",
                "Chips Brets saveur Cheddar Oignons de Roscoff",
                "Chips Brets saveur Tartiflette",
                "Chips Brets saveur Pastis",
                "Chips Brets saveur Cheddar Jalape√±o",
                "Chips Brets saveur Sauce Curry",
                "Chips Brets saveur Bleu d'Auvergne AOP",
                "Chips Brets saveur Yakitori",
                "Chips Brets saveur Poivrons Grill√©s Chorizo",
                "Chips Brets saveur Sauce Barbecue",
                "Chips Brets saveur C√¥te de B≈ìuf Grill√©e",
                "Chips Brets saveur Fromage Frais Fines Herbes",
                "Chips Brets saveur Pizza au Feu de Bois",
                "Chips Brets saveur Petits Oignons",
                "Chips Brets saveur Brebis Cerise",
                "Chips Brets saveur Tomates S√©ch√©es & Vinaigre Balsamique",
                "Chips Brets saveur √âchalotes au Vinaigre Balsamique",
                "Chips Brets saveur Chorizo",
                "Chips Brets saveur Moutarde √† l'Ancienne",
                "Chips Brets saveur Chili Pointe de Menthe",
                "Chips Brets saveur Poulet Tandoori",
                "Chips Brets saveur Sauce Andalouse",
                "Chips Brets saveur Baies Roses & Poivre",
                "Chips Brets saveur Cr√®me & Oignons",
                "Chips Brets saveur Ail & Fines Herbes",
                "Chips Brets saveur Sarrasin Curry Cr√®me",
                "Chips Brets saveur Sarrasin au Ch√®vre",
                "Chips Brets saveur Sarrasin Classique",

                "Glace (vanille, chocolat, fraise‚Ä¶)",
                "Cookie",
                "Brownie",
                "Muffin",
                "Tartelette aux fruits",
                "Compote de pommes",
                "Yaourt nature ou sucr√©"
            ]
        };

        // Fonction pour remplir les listes d'ingr√©dients
        function populateIngredientLists() {
            for (const [category, items] of Object.entries(ingredients)) {
                const listElement = document.getElementById(`${category}-list`);
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = item;
                    listElement.appendChild(li);
                });
            }
        }

        // Fonction pour choisir un √©l√©ment al√©atoire d'un tableau
        function getRandomItem(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        // Fonction pour faire tourner la roulette
        function spinWheel() {
            const spinButton = document.getElementById('spin-button');
            const wheel = document.getElementById('wheel');
            const spinningText = document.getElementById('spinning-text');

            // D√©sactiver le bouton pendant le tirage
            spinButton.disabled = true;
            spinButton.classList.add('opacity-50');

            // R√©initialiser les r√©sultats
            document.getElementById('bread-result').textContent = "...";
            document.getElementById('meat-result').textContent = "...";
            document.getElementById('cheese-result').textContent = "...";
            document.getElementById('extra-result').textContent = "...";

            // Animation de la roue
            spinningText.textContent = "üîÑ";
            spinningText.classList.add('bounce');

            // Faire tourner la roue
            const rotations = 1080 + Math.random() * 360; // 3 tours + angle al√©atoire
            wheel.style.transform = `rotate(${rotations}deg)`;

            // S√©lection s√©quentielle des ingr√©dients
            const categories = ['bread', 'meat', 'cheese', 'extra'];
            let delay = 1000;

            categories.forEach(category => {
                setTimeout(() => {
                    const selectedItem = getRandomItem(ingredients[category]);
                    document.getElementById(`${category}-result`).textContent = selectedItem;

                    // Mettre √† jour le texte de la roue
                    if (category === 'bread') {
                        spinningText.textContent = "Pain!";
                    } else if (category === 'meat') {
                        spinningText.textContent = "Viande!";
                    } else if (category === 'cheese') {
                        spinningText.textContent = "Fromage!";
                    } else if (category === 'extra') {
                        spinningText.textContent = "Extra!";
                    }
                }, delay);

                delay += 700; // Ajouter un d√©lai pour chaque cat√©gorie
            });

            // R√©activer le bouton apr√®s la fin de l'animation
            setTimeout(() => {
                spinButton.disabled = false;
                spinButton.classList.remove('opacity-50');
                spinningText.classList.remove('bounce');
                spinningText.textContent = "Termin√©!";

                // R√©initialiser la rotation de la roue
                setTimeout(() => {
                    wheel.style.transition = 'none';
                    wheel.style.transform = 'rotate(0deg)';
                    setTimeout(() => {
                        wheel.style.transition = 'transform 3s cubic-bezier(0.2, 0.8, 0.2, 1)';
                    }, 50);
                }, 500);
            }, delay);
        }

        // Fonction pour sauvegarder le sandwich actuel
        function saveSandwich() {
            const sandwich = {
                bread: document.getElementById('bread-result').textContent,
                meat: document.getElementById('meat-result').textContent,
                cheese: document.getElementById('cheese-result').textContent,
                extra: document.getElementById('extra-result').textContent,
                date: new Date().toLocaleString()
            };

            // V√©rifier si c'est un sandwich valide (pas de valeurs par d√©faut)
            if (sandwich.bread === "---" || sandwich.bread === "..." ||
                sandwich.meat === "---" || sandwich.meat === "..." ||
                sandwich.cheese === "---" || sandwich.cheese === "..." ||
                sandwich.extra === "---" || sandwich.extra === "...") {
                alert("Veuillez d'abord lancer la roulette pour g√©n√©rer un sandwich!");
                return;
            }

            // R√©cup√©rer l'historique existant
            let history = JSON.parse(localStorage.getItem(SANDWICH_HISTORY_KEY) || '[]');

            // Ajouter le nouveau sandwich
            history.unshift(sandwich); // Ajouter au d√©but

            // Limiter √† 20 sandwichs maximum
            if (history.length > 20) {
                history = history.slice(0, 20);
            }

            // Sauvegarder l'historique
            localStorage.setItem(SANDWICH_HISTORY_KEY, JSON.stringify(history));

            // Mettre √† jour l'interface
            updateHistoryUI();

            // Animation de confirmation
            const saveButton = document.getElementById('save-button');
            saveButton.textContent = "‚úÖ Sauvegard√©!";
            setTimeout(() => {
                saveButton.textContent = "üíæ Valider ce sandwich";
            }, 2000);
        }

        // Fonction pour mettre √† jour l'interface de l'historique
        function updateHistoryUI() {
            const history = JSON.parse(localStorage.getItem(SANDWICH_HISTORY_KEY) || '[]');
            const historyBanner = document.getElementById('history-banner');
            const historyCount = document.getElementById('history-count');

            if (history.length > 0) {
                historyBanner.classList.remove('hidden');
                historyCount.textContent = history.length;
            } else {
                historyBanner.classList.add('hidden');
            }
        }

        // Fonction pour afficher l'historique complet
        function showHistory() {
            const history = JSON.parse(localStorage.getItem(SANDWICH_HISTORY_KEY) || '[]');
            const historyList = document.getElementById('history-list');
            const historyModal = document.getElementById('history-modal');

            // Effacer le contenu pr√©c√©dent
            historyList.innerHTML = '';

            if (history.length === 0) {
                historyList.innerHTML = '<p class="text-gray-500 text-center py-6">Aucun sandwich enregistr√©</p>';
            } else {
                // Cr√©er un √©l√©ment pour chaque sandwich
                history.forEach((sandwich, index) => {
                    const sandwichEl = document.createElement('div');
                    sandwichEl.className = 'p-3 bg-yellow-50 rounded border border-yellow-200';
                    sandwichEl.innerHTML = `
                        <div class="flex justify-between items-start">
                            <h4 class="font-medium">Sandwich #${index + 1}</h4>
                            <span class="text-xs text-gray-500">${sandwich.date}</span>
                        </div>
                        <div class="mt-2 grid grid-cols-2 gap-2">
                            <div><span class="font-medium">Pain:</span> ${sandwich.bread}</div>
                            <div><span class="font-medium">Viande:</span> ${sandwich.meat}</div>
                            <div><span class="font-medium">Fromage:</span> ${sandwich.cheese}</div>
                            <div><span class="font-medium">Extra:</span> ${sandwich.extra}</div>
                        </div>
                    `;
                    historyList.appendChild(sandwichEl);
                });
            }

            // Afficher la modal
            historyModal.classList.remove('hidden');
        }

        // Fonction pour effacer l'historique
        function clearHistory() {
            if (confirm("√ätes-vous s√ªr de vouloir effacer tout l'historique des sandwichs?")) {
                localStorage.removeItem(SANDWICH_HISTORY_KEY);
                updateHistoryUI();
                document.getElementById('history-modal').classList.add('hidden');
            }
        }

        // Initialiser la page
        document.addEventListener('DOMContentLoaded', () => {
            populateIngredientLists();

            // Roulette
            document.getElementById('spin-button').addEventListener('click', spinWheel);

            // Sauvegarde
            document.getElementById('save-button').addEventListener('click', saveSandwich);

            // Historique
            document.getElementById('show-history-button').addEventListener('click', showHistory);
            document.getElementById('close-history-button').addEventListener('click', () => {
                document.getElementById('history-modal').classList.add('hidden');
            });
            document.getElementById('clear-history-button').addEventListener('click', clearHistory);

            // Activer/d√©sactiver le bouton de sauvegarde en fonction du r√©sultat
            const saveButton = document.getElementById('save-button');
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'characterData' || mutation.type === 'childList') {
                        const breadResult = document.getElementById('bread-result').textContent;
                        if (breadResult !== "---" && breadResult !== "...") {
                            saveButton.disabled = false;
                            saveButton.classList.remove('opacity-50');
                        } else {
                            saveButton.disabled = true;
                            saveButton.classList.add('opacity-50');
                        }
                    }
                });
            });

            // Observer les changements de r√©sultats
            const config = { childList: true, characterData: true, subtree: true };
            observer.observe(document.getElementById('bread-result'), config);

            // Charger l'historique au d√©marrage
            updateHistoryUI();
        });
    </script>
</body>

</html>